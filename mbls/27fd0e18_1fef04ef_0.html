<html><head></head>
<body>

<div><font class="Apple-style-span" face="Consolas"><br></font></div><div><font class="Apple-style-span" face="Consolas"><br></font></div><div><div><font class="Apple-style-span" size="4" face="Consolas"><span class="Apple-style-span" style="background-color: rgb(255, 255, 255); "><b>1. php 中 $_SESSION的作用域问题？</b></span></font></div><div><font class="Apple-style-span" size="4" face="Consolas"><span class="Apple-style-span" style="background-color: rgb(255, 255, 255); "><br></span></font></div><div><span class="Apple-style-span" style="background-color: rgb(255, 255, 255); "><font class="Apple-style-span" face="Consolas"><font class="Apple-style-span" size="4">&nbsp; &nbsp; a.&nbsp;</font>网友问题描述如下：</font></span></div><div><font class="Apple-style-span" size="4" face="Consolas"><span class="Apple-style-span" style="background-color: rgb(255, 255, 255); "><br></span></font></div><div><span class="Apple-style-span" style="background-color: rgb(255, 255, 255); "><font class="Apple-style-span" face="Consolas">&nbsp; &nbsp; &nbsp; &nbsp; 问：我在localhost下建立一个应用localhost/cms，又建立一个应用localhost/guest，两个应用的后台管理员登录session名称相同$_SESSION['admin']，这样发现登录到cms系统后，再进入guest后台发现不需要验证就能进入后台管理页面了，请问应该怎样避免这个问题？</font></span></div><div><span class="Apple-style-span" style="background-color: rgb(255, 255, 255); "><font class="Apple-style-span" face="Consolas"><br></font></span></div><div><span class="Apple-style-span" style="background-color: rgb(255, 255, 255); "><font class="Apple-style-span" face="Consolas">&nbsp; &nbsp; &nbsp; &nbsp; 答：session是保存在服务器上面的一个文件，默认情况下，这些文件共享一个目录。要避免这种情况，你需要更改服务器保存session的路径。需要在session_start()之前调用session_save_path(string $path)。</font></span></div></div><div><span class="Apple-style-span" style="background-color: rgb(255, 255, 255); "><font class="Apple-style-span" face="Consolas"><br></font></span></div><div><span class="Apple-style-span" style="background-color: rgb(255, 255, 255); "><font class="Apple-style-span" face="Consolas"><br></font></span></div><div><span class="Apple-style-span" style="background-color: rgb(255, 255, 255); "><font class="Apple-style-span" face="Consolas">&nbsp; &nbsp; b. PHP中SESSION使用中的一点经验总结 [1]</font></span></div><div><span class="Apple-style-span" style="background-color: rgb(255, 255, 255); "><font class="Apple-style-span" face="Consolas"><br></font></span></div><div><span class="Apple-style-span" style="background-color: rgb(255, 255, 255); "><font class="Apple-style-span" face="Consolas">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;SESSION会话开启时(<b><font class="Apple-style-span" color="#ff0000">session_start();</font></b> )，会首先发送一个对浏览器的唯一标识session_id的cookie(名字为PHPSESSID可以通过session_name()获取)，同session.save_handler = files的情况下，在服务器的指定目录（如temp）下生成一个没有后缀的文件，名字是:&nbsp;'sess_" + 'session_id'; </font></span></div><div><span class="Apple-style-span" style="background-color: rgb(255, 255, 255); "><font class="Apple-style-span" face="Consolas"><br></font></span></div><div><span class="Apple-style-span" style="background-color: rgb(255, 255, 255); "><font class="Apple-style-span" face="Consolas">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;在下一次发起http请求时，首先浏览器会发送这个当前域名下的所有cookie名字和值过去，这样服务器就能根据cookie中的session_id来去读取session文件，而不会混淆这个session属于谁。假如浏览器没有发送PHPSESSID的cookie过来就发送一个过去，有就读取这个cookie，这样就能<b>维持同一个会话</b>。  </font></span></div><div><span class="Apple-style-span" style="background-color: rgb(255, 255, 255); "><font class="Apple-style-span" face="Consolas"><br></font></span></div><div><span class="Apple-style-span" style="background-color: rgb(255, 255, 255); "><font class="Apple-style-span" face="Consolas">&nbsp; &nbsp; &nbsp; &nbsp; 假如这个session文件我们手动删除了，那么session失效，假如浏览器cookie失效，那么session照样失效。</font></span></div><div><font class="Apple-style-span" face="Consolas"><br></font></div><div><font class="Apple-style-span" face="Consolas"><span class="Apple-style-span" style="background-color: rgb(255, 255, 255); ">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>在服务器端，可以用<font class="Apple-style-span" color="#ff0000"><b>session_ destroy()</b></font> 或者<b><font class="Apple-style-span" color="#ff0000">session_ unset()</font></b>来使其失效。</font></div><div><font class="Apple-style-span" face="Consolas"><br></font></div><div><font class="Apple-style-span" face="Consolas"><span class="Apple-style-span" style="background-color: rgb(255, 255, 255); ">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>在浏览器端：可以直接setcookie('PHPSESSID','',123);&nbsp;让cookie过期，或者另外一种方式，但不能立即失效&nbsp;session_set_cookie_params($time);//当前时间戳上的秒，例如60，即让其60秒后过期。</font></div><div><font class="Apple-style-span" face="Consolas"><br></font></div><div><font class="Apple-style-span" face="Consolas"><span class="Apple-style-span" style="background-color: rgb(255, 255, 255); ">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>让session延迟。须修改php.ini里的配置（<b><font class="Apple-style-span" color="#0000ff">session.gc_maxlifetime</font></b>）设置过期时间。，到了这个时间，就有session.gc_probability /session.gc_divisor的概率被回收（leo, 此处不解。）。假如到了这个时间，并且启动了GC进程，GC会去读取session文件的修改时间（mtime），发现大于和当前时间相减后大于session.gc_maxlifetime ，立刻删除。到此，我们也就明白了如何保持这个会话呢，只能在session.gc_maxlifetime 内，必须有用户在访问，每次访问都去修改下session,这样就这个session又多出session.gc_maxlifetime的存活时间。</font></div><div><font class="Apple-style-span" face="Consolas"><br></font></div><div><font class="Apple-style-span" face="Consolas"><span class="Apple-style-span" style="background-color: rgb(255, 255, 255); ">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>关于<font class="Apple-style-span" color="#0000ff"><b>session.cookie_lifetime</b></font>, 设置PHPSESSID在浏览器的存活时间，默认为0. IE下我发现是正常的，<font class="Apple-style-span" color="#ff6600"><b>浏览器重启即cookie失效</b></font>；Firefox下还继续存在(Leo注：后续解决文章没交行清楚，可能是火狐的会话保存功能)。设置session.cookie_lifetime可以用&nbsp;<b><font class="Apple-style-span" color="#ff0000">session_set_cookie_params()</font></b>.</font></div><div><p><font class="Apple-style-span" face="Consolas"><span class="Apple-style-span" style="background-color: rgb(255, 255, 255); ">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>session_set_cookie_params(60);//60 s session_start(); </font></p>
<p><font class="Apple-style-span" face="Consolas"><span class="Apple-style-span" style="background-color: rgb(255, 255, 255); ">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>session.gc_maxlifetime和session.cookie_lifetime 共同决定了session的生存时间。</font></p></div><div><font class="Apple-style-span" face="Consolas"><br></font></div><div><font class="Apple-style-span" face="Consolas"><br></font></div><div><font class="Apple-style-span" face="Consolas"><br></font></div><div><font class="Apple-style-span" face="Consolas"><br></font></div><div><font class="Apple-style-span" face="Consolas"><br></font></div><div><font class="Apple-style-span" face="Consolas"><br></font></div><div><font class="Apple-style-span" face="Consolas"><b>References</b></font></div><div><font class="Apple-style-span" face="Consolas"><br></font></div><div><font class="Apple-style-span" face="Consolas">&nbsp; &nbsp; [1]&nbsp;PHP中SESSION使用中的一点经验总结 &nbsp;<a href="http://www.jb51.net/article/30006.htm">http://www.jb51.net/article/30006.htm</a></font></div><div><font class="Apple-style-span" face="Consolas"><br></font></div><div><font class="Apple-style-span" face="Consolas"><br></font></div><div><font class="Apple-style-span" face="Consolas"><br></font></div><div><font class="Apple-style-span" face="Consolas"><br></font></div><div><font class="Apple-style-span" face="Consolas"><br></font></div><div><font class="Apple-style-span" face="Consolas"><br></font></div><div><font class="Apple-style-span" face="Consolas"><br></font></div><div><font class="Apple-style-span" face="Consolas"><br></font></div><div><font class="Apple-style-span" face="Consolas"><br></font></div><div><font class="Apple-style-span" face="Consolas"><br></font></div><div><font class="Apple-style-span" face="Consolas"><br></font></div><div><font class="Apple-style-span" face="Consolas"><br></font></div><div><font class="Apple-style-span" face="Consolas"><br></font></div><div><font class="Apple-style-span" face="Consolas"><br></font></div><div><font class="Apple-style-span" face="Consolas"><br></font></div><div><font class="Apple-style-span" face="Consolas"><br></font></div><div><font class="Apple-style-span" face="Consolas"><br></font></div><div><font class="Apple-style-span" face="Consolas"><br></font></div><div><font class="Apple-style-span" face="Consolas"><br></font></div><div><font class="Apple-style-span" face="Consolas"><br></font></div><div><font class="Apple-style-span" face="Consolas"><br></font></div><div><font class="Apple-style-span" face="Consolas"><br></font></div><div><font class="Apple-style-span" face="Consolas"><br></font></div><div><font class="Apple-style-span" face="Consolas">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></div><script type="text/javascript" language="javascript" src="jquery.js"></script><script type="text/javascript" language="javascript" src="itemlink.js"></script></body></html>